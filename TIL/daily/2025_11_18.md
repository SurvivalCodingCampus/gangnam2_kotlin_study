## 2025_11_18 비동기 프로그래밍

### 용어 정리

#### 동기 vs 비동기

- 작업 완료를 기다리는 방식의 차이
- **동기**
    - 한 작업이 끝날 때까지 기다렸다가 다음 작업을 시작한다.
- **비동기**
    - 기다리지 않고 다른 작업을 시작한다.

#### 동시성 vs 병렬성

- 여러 작업을 처리하는 방식에 대한 차이
- 동시성
    - 여러 작업을 번갈아가며 처리
- 병렬성
    - 여러 작업을 실제로 동시에 처리

#### 동기 프로그래밍 (Synchronous)

- 코드가 순서대로 실행된다.
- 작업이 완료될 때까지 프로그램이 중단될 수 없다.
- 모든 작업은 이전 작업의 실행이 완료될 때까지 기다려야 한다.

#### 비동기 프로그래밍 (Asynchronous)

- 여러 작업이 병렬로 실행될 수 있다
- 한 작업이 완료 여부와 상관없이 다음 작업을 시작할 수 있다
- 작업의 완료 순서를 예측할 수 없다
- I/O 작업이나 네트워크 요청과 같이 시간이 오래 걸리는 작업에 유용

### 스레드

- 작업 실행의 최소 단위
- Thread의 stop, suspend, destroy 등 이런 메서드는 휴먼 에러가 발생할 수 있다.

### Coroutine

- suspend 를 사용하면 비동기 함수다 라고 선언하는 것
- delay() -> 스레드가 블록되지 않는다.
- 비동기 함수를 사용할려면 제약이 많다.

### 코루틴 스코프

- 코루틴은 스코프에 의존적이다.

```kotlin
fun main() = runBlocking {
    launch {
        delay(10000L)
        println("World")
    }
    println("Hello")
}
```

- 코루틴 스코프 안에서 코루틴을 시작할 수 있다.

### 코루틴 빌더

- 새로운 코루틴을 시작하는 함수를 코루틴 빌더라고 한다.
- `runBlocking`, `withContext`, `ContextScope.launch`, `ContextScope.async` 등
- 코루틴 빌더는 코루틴의 생명주기를 제한하는 CoroutineScope를 생성한다.
- launch 로 새로운 코루틴을 시작해도 독립적으로 동작한다.

- launch : 결과가 필요없는 비동기 작업 / 반환값 : Job
- async : 결과가 필요한 비동기 작업 / 반환값 : Deferred<T>
- runBlocking : 코루틴과 일반 코드 연결 / 반환값 : T
- delay
    - suspend 함수는 일정시간 코루틴을 일시 정지 한다.
    - 코루틴이 정지되어도 Main Thread 는 차단되지 않는다.

### 코루틴

- 코루틴은 기본적으로 순차 실행된다.
- 코루틴으로 병렬 실행 : async 코루틴 빌더와 await 함수
    - async는 launch와 기본적으로 동일한 코루틴 빌더이지만 Job 대신 나중에 결과를 리턴하는 Defferred 타입을 반환
    - Deferred는 await()를 통해 미래의 값을 얻는다!

### Job

- 코루틴 빌더에 의해 작성된 코루틴
- launch 는 Job을 리턴한다
- Job을 통해 실행중인 코루틴을 제어 가능!

```kotlin
fun main() = runBlocking {
    println(1)
    val job: Job = launch {
        delay(10000L)
        print(2)
    }
    job.join()
    job.cancel()
}
```

- join() 은 해당 코루틴 내의 처리가 끝나는 것을 기다린다.
- cancel()을 통해 취소 가능

### Dispatcher

#### Default

- 백그라운드 스레드
- 코어 수에 비례해서 스레드를 만든다. 연산용
- CPU에 부하를 줄 만한 처리 (로컬에서 List 정렬 등)

#### Main

- 메인 스레드에 연결되는 디스패처

#### IO

- 백그라운드 스레드
- Input/Output 조작용
- 상대적으로 많은 스레드를 만드는 디스패처 (DB 통신 / Http 통신)

### withContext()

- 디스패처를 전환해 주는 함수