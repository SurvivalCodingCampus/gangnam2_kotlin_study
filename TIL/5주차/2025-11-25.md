# DTO & Mapper

## 1️⃣ DTO(Data Transfer Object)의 역할

- **목적**: 데이터 소스(JSON 등)를 그대로 받는 **중간 전달 객체**.
- 서버에서 내려오는 데이터가:
    - 동적 JSON인 경우 (예: `id`가 `"1"` 이기도 하고 `1` 이기도 한 경우)
    - `null` 이 섞여 있거나, 문서와 다른 이상한 값이 섞여 있는 경우
- 이런 **불완전한/신뢰하기 어려운 데이터**를 먼저 DTO에 안전하게 담아두기 위한 방어 수단이다.
- 레포지토리를 미리 구현할 때도, 외부 데이터 형식이 확정되지 않았으면 DTO로 받으면서 개발할 수 있다.

---

## 2️⃣ DTO → Model 변환(Mapper)의 역할

- DTO는 **일단 서버 값을 있는 그대로 모두 받는 레이어**이고,
- 실제 앱에서 사용할 **모델 클래스(Model)** 는 사용하기 편한 형태로 다시 정의한다.
- 이때 변환 로직을 담당하는 것이 **Mapper**이다.
    - Mapper = DTO를 모델 클래스로 변환하는 유틸리티 메서드.
    - Kotlin에서는 **확장 함수**로 구현하는 것을 추천.
        - 예: `fun PhotoDto.toModel(): Photo { ... }`

---

## 3️⃣ Nullable → Non-nullable 변환

- JSON 데이터에는 `null` 이 섞여 들어올 수 있다.
- 하지만 앱 내부 모델은 **가능하면 non-nullable** 로 설계하는 것이 사용하기 편하다.
- 따라서 Mapper에서:
    - `String?`, `Int?`, `LocalDateTime?` 등 DTO의 nullable 값을
    - 기본값, 변환 로직 등을 이용해 **non-nullable** 로 바꿔 넣는다.

---

## 4️⃣ DTO를 도입하면 좋은 상황

- 데이터 소스(JSON)에 다음과 같은 문제가 있을 때:
    - 타입이 일정하지 않음 (예: `"1"` vs `1`)
    - 문서에 없는 `null` 이 들어옴
    - 일부 필드가 빠져 있거나 형식이 자주 바뀜
- 이런 경우 DTO를 두면:
    - Map/JSON → DTO 단계에서 예외 없이 넉넉하게 데이터를 받고,
    - DTO → Model 단계에서 필요한 필드만 골라서, 기본값을 주거나 변환 로직을 적용하기 용이하다.

---

## 5️⃣ DTO가 필요 없는 경우

- 서버 JSON 스펙이 안정적이고,
- 모든 필드 타입, null 여부가 명확히 보장되며,
- 그대로 도메인 모델로 사용해도 문제가 없다면

반드시 DTO를 도입할 필요는 없다.  
다만 **불완전하거나 바뀔 여지가 느껴지는 데이터라면 DTO를 고려하자.**

---

## 알아두면 좋은 내용

- 코루틴을 사용할 때 작업 종류에 맞는 디스패처를 명시적으로 사용한다.
- 특히 IO 작업(파일, 네트워크 등)은 `Dispatchers.IO`를 사용한다고 코드에 남겨 두면 좋다.
    - 예: `withContext(Dispatchers.IO) { ... }`
