# Flow

> ì½”í‹€ë¦° ê³µì‹ ë¹„ë™ê¸° API ì¤‘ì— í•˜ë‚˜
ë°ì´í„°ê°€ ê³„ì† íë¥´ëŠ” ê²ƒì„ í‘œí˜„í•¨
>

- ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ í‘œí˜„í•˜ê¸° ìœ„í•œ êµ¬ì¡°
    - ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œ ë‚˜ì˜¨ ê°œë…
    - Stateë¥¼ ë°˜ì˜í•˜ì—¬ UIê°€ ë³€í•˜ëŠ” ê²ƒë„ ë°˜ì‘í˜•
- LiveDataëŠ” ì•ˆë“œë¡œì´ë“œì˜ Life cycleê³¼ ê¹Šê²Œ ì—°ê´€ë˜ì–´ ìˆëŠ” ë°˜ë©´
  FlowëŠ” ìˆœìˆ˜ ì½”í‹€ë¦° API â†’ ë³µì¡í•˜ê³  ë¬¸ì œê°€ ë§ìŒ
    - LiveDataëŠ” ìˆœìˆ˜í•œ ë°ì´í„°ë¥¼ ìœ„í•œ ê²ƒì´ ì•„ë‹˜. ì•ˆë“œë¡œì´ë“œë¥¼ ìœ„í•œ ê²ƒ

- ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°ì˜ í•µì‹¬
    - ë°ì´í„°ê°€ ê´€ì°°ë˜ë©´ ë°ì´í„°ë¥¼ ë°˜ì˜í•´ì„œ í™”ë©´ì— ê·¸ë¦¬ì!

## ğŸ“Œ Flowë€?

- FlowëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ê³„ì‚°ë˜ëŠ” **ë°ì´í„° ìŠ¤íŠ¸ë¦¼**
    - Flowë¡œ ê°ì‹¸ë©´ ë³€ê²½ë˜ëŠ” ë°ì´í„°ê°€ ê³„ì† ë“¤ì–´ì˜¤ëŠ” ê²ƒì„
- ì½”ë£¨í‹´ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•¨
- ì—¬ëŸ¬ ê°’ì„ ìˆœì°¨ì ìœ¼ë¡œ ë°©ì¶œí•  ìˆ˜ ìˆìŒ
- **Cold Stream ë°©ì‹**

- **ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì€ 2ê°€ì§€ ë°©ì‹ì´ ìˆìŒ**
    1. Cold Stream ë°©ì‹) ê´€ì°°í•˜ëŠ” ì‹œì ì— ë°ì´í„°ê°€ ë“¤ì–´ì˜´
    2. Hot Stream ë°©ì‹) ê´€ì°°í•˜ì§€ ì•Šì•„ë„ ê³„ì† ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ê³  ìˆìŒ

### flow() ë¹Œë”

- flow ë¹Œë”ëŠ” ì½”ë£¨í‹´ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•˜ëŠ”ë° ì‚¬ìš©ë¨
- flow ë¹Œë” ë‚´ë¶€ëŠ” ì´ë¯¸ CorutineScopeë¼ì„œ suspend í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

  (ì •í™•íˆëŠ” `suspend` ëŒë‹¤ë¼ì„œ ê°€ëŠ¥)

- `emit()` : Flow ë‚´ì—ì„œ ë°ì´í„°ë¥¼ ë°©ì¶œí•  ë•Œ ì‚¬ìš©

- `launchIn()` : Flowë¥¼ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì—ì„œ ìˆ˜ì§‘í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
    - ì½”ë£¨í‹´ì„ ë°”ê¿”ê°€ë©´ì„œ í™•ì¸í•´ì•¼í•  ë•Œ
    - ì£¼ë¡œ ViewModelì—ì„œ ë§ì´ ì‚¬ìš©ë¨

### **1. ê¸°ë³¸ Flow ìƒì„±ê³¼ ìˆ˜ì§‘(collect)**

```kotlin
println("\n1. ê¸°ë³¸ Flow")
val basicFlow = flow {
    for (i in 1..3){
        delay(100)
        println("Emitting $i")
        emit(i)
    }
}

basicFlow.collect { value ->
    println("Collected: $value")
}
```

- emitê°€ ë°©ì¶œí•˜ëŠ” ì—­í• ì„ í•˜ì§€ë§Œ, collectë¡œ ê´€ì°°ë˜ëŠ” ì‹œì ì— ì‹¤ì œë¡œ ë°©ì¶œëœë‹¤ (Cold)

1. **Flow ë¹Œë”**

```kotlin
flowOf(1, 2, 3).collect { println("flowOf: $it") }
(1..3).asFlow().collect { println("asFlow: $it") }
```

- `asFlow()` : ì»¬ë ‰ì…˜ì„ Flowë¡œ ë³€í™˜
- `flowOf()` : Flow ê°„ë‹¨íˆ ë§Œë“¤ ìˆ˜ ìˆìŒ. but, í…ŒìŠ¤íŠ¸ ì½”ë“œ ì™¸ì—ì„œëŠ” ì˜ ì•ˆì”€

1. **Flow ì—°ì‚°ì**
    - map
    - filter
    - take
    - onEach (forEachë‘ ë¹„ìŠ·í•œ ì• )

### 4. Flow í•©ì¹˜ê¸°

| zip | combine |
| --- | --- |
|  |  |
|  |  |
|  |  |
|  |  |

**4-1) Flow í•©ì¹˜ê¸°: Zip ì—°ì‚°ì**

- ë‘ ê°œ ì´ìƒì˜ Flowë¥¼ ê²°í•©í•˜ì—¬ ìƒˆë¡œìš´ Flowë¥¼ ìƒì„±í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ì—°ì‚°ì
- ê° Flowì—ì„œ ë°©ì¶œëœ ê°’ì„ ìŒìœ¼ë¡œ ë¬¶ì–´ ìƒˆë¡œìš´ ê°’ì„ ìƒì„±
- ë‘ Flowì—ì„œ ëª¨ë‘ ê°’ì„ ë°©ì¶œí•  ë•Œë§Œ í˜¸ì¶œë¨

```kotlin
val flow1 = flowOf("A", "B", "C")
val flow2 = flowOf(1, 2, 3)

flow1.zip(flow2) { a, b -> "$a$b" }
    .collect { println("Zipped: $it") }
```

**4-2) Flow í•©ì¹˜ê¸°: Combine ì—°ì‚°ì**

1. **ì—ëŸ¬ ì²˜ë¦¬**

catchë¥¼ í†µí•´ ì—ëŸ¬ì²˜ë¦¬ ê°€ëŠ¥

## ğŸ“Œ StateFlow

```kotlin
// ë””í´íŠ¸ê°’ í•„ìš”. ê°’ì´ í•˜ë‚˜ëŠ” ìˆì–´ì•¼ í•¨
val stateFlow: MutableStateFlow<Int> = MutableStateFlow(0)
```

- StateFlowëŠ” ì½”ë£¨í‹´ì—ì„œ ì œê³µí•˜ëŠ” íŠ¹ë³„í•œ **Hot Stream** Flow ì„
    - ë¦¬ì–¼ íƒ€ì„ìœ¼ë¡œ ë°ì´í„° ë¿Œë ¤ì•¼í•  ë•Œ
- í•­ìƒ ìµœì‹  ìƒíƒœë¥¼ ìœ ì§€ (ì†Œë¹„ë˜ì§€ ì•Šê³  ë§ˆì§€ë§‰ ê°’ì´ ë‚¨ì•„ ìˆìŒ)
    - Hot Streamì€ ì¼ë°˜ì ìœ¼ë¡œ ë§ˆì§€ë§‰ ê°’ì´ ì†Œë¹„ë˜ë©´ ê°’ì„ ê°€ì§€ì§€ ì•ŠìŒ â†’ íŠ¹ì´í•œ ì• ì„
    - ìƒíƒœ ë³€í™”ë¥¼ ê´€ì°°í•˜ê³ , ìµœì‹  ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ”ë° ìœ ìš©í•¨ â¡ï¸ ì•ˆë“œë¡œì´ë“œì—ì„œ ì£¼ë¡œ UI ìƒíƒœ ê´€ë¦¬ì— ì‚¬ìš©

      ì™œ?? â€” ë§ˆì§€ë§‰ ê°’ì´ ì†Œë¹„ë˜ë©´ UIê°€ ì‚¬ë¼ì§. ë§ˆì§€ë§‰ ê°’ìœ¼ë¡œ ìµœì‹  ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼í•¨!!!

- Thread Safe
- StateFlowëŠ” ì½ê¸° ì „ìš©ì´ë©°, ìƒíƒœë¥¼ ë³€ê²½í•˜ë ¤ë©´ MutableStateFlowë¥¼ ì‚¬ìš©

1. ë³‘ë ¬ ì²˜ë¦¬
    - `flatMapMerge`

1. **ì»¨í…ìŠ¤íŠ¸ ì „í™˜**

```kotlin

```

- `flowOn(ë””ìŠ¤íŒ¨ì²˜)` : Flowì˜ ì—°ì‚°ì„ íŠ¹ì • ë””ìŠ¤íŒ¨ì²˜ì—ì„œ ì‹¤í–‰í•˜ë„ë¡ ì§€ì • ê°€ëŠ¥

### 9. debounce

```kotlin
flow {
}.debounce(100) // 100ì„ ë„˜ëŠ” ë”œë ˆì´ëŠ” ë¬´ì‹œí•˜ê² ë‹¤
```

- `debounce` : ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ì—ì„œ ë¶ˆí•„ìš”í•œ ì´ë²¤íŠ¸ë¥¼ ì¤„ì´ê³ , ì„±ëŠ¥ì„ ìµœì í™”í•˜ëŠ”ë° ìœ ìš©
    - ì—°íƒ€ ë°©ì§€, API í˜¸ì¶œíšŸìˆ˜ ì»¨íŠ¸ë¡¤ ë“±ì— í™œìš©

- ì˜ˆì œ ì½”ë“œ

    ```kotlin
    val flow9 = flow{
        emit("A")
        delay(100)
        emit("B")
        delay(90)
        emit("C")
        delay(110)
        emit("D")
        delay(80)
        emit("E")
    }.debounce(100)
        .collect { println("Debounced: $it") }
    // ì¶œë ¥: A, C, E
    ```

  | **ì‹œì ** | **flow ì´ë²¤íŠ¸** | **ì´ ê°’ì˜ ë”œë ˆì´ (ms)** | **debounce ë™ì‘** | **ì¶œë ¥** |
      | --- | --- | --- | --- | --- |
  | T=0 | **"A"** ë°©ì¶œ | - | `debounce` íƒ€ì´ë¨¸ ì‹œì‘ (100ms) | - |
  | T=100 | - | (100ms ê²½ê³¼) | íƒ€ì´ë¨¸ ë§Œë£Œ, **"A"** í†µê³¼ | **Debounced: A** |
  | T=100 | **"B"** ë°©ì¶œ | (delay 100) | `debounce` íƒ€ì´ë¨¸ ì¬ì‹œì‘ (100ms) | - |
  | T=190 | **"C"** ë°©ì¶œ | (delay 90) | **100ms ë¯¸ë§Œ** ê²½ê³¼, ì´ì „ ê°’ **"B" ë¬´ì‹œ**, íƒ€ì´ë¨¸ ì¬ì‹œì‘ (100ms) | - |
  | T=300 | - | (110ms ê²½ê³¼) | íƒ€ì´ë¨¸ ë§Œë£Œ, **"C"** í†µê³¼ | **Debounced: C** |
  | T=300 | **"D"** ë°©ì¶œ | (delay 110) | `debounce` íƒ€ì´ë¨¸ ì¬ì‹œì‘ (100ms) | - |
  | T=380 | **"E"** ë°©ì¶œ | (delay 80) | **100ms ë¯¸ë§Œ** ê²½ê³¼, ì´ì „ ê°’ **"D" ë¬´ì‹œ**, íƒ€ì´ë¨¸ ì¬ì‹œì‘ (100ms) | - |
  | T=480 | - | (100ms ê²½ê³¼) | íƒ€ì´ë¨¸ ë§Œë£Œ, **"E"** í†µê³¼ | **Debounced: E** |

---

## Androidì—ì„œì˜ í™œìš© íŒ¨í„´

### ğŸ“Œ StateFlow

```kotlin
private var _state = MutableStateFlow(MainState())    // ì“°ê¸° ê°€ëŠ¥í•œ StateFlow
val state: StateFlow<MainState> = _state    // ì½ê¸° ì „ìš© StateFlow
```

- StateFlowëŠ” ì´ˆê¸°ê°’ì´ í•„ìˆ˜, LiveDataëŠ” ì´ˆê¸°ê°’ì´ ì„ íƒì ì´ë‹¤
- êµ¬ë…ìê°€ í•„ìš”í•  ë•Œ ê°’ì„ ì–»ëŠ”ë‹¤
- ê°’ì´ ë³€ê²½ë  ë•Œë§Œ êµ¬ë…ìì—ê²Œ ê°’ì„ ì „ë‹¬í•¨
- value í”„ë¡œí¼í‹°ë¡œ ê°’ì„ get/set í•  ìˆ˜ ìˆë‹¤
- Flowê°€ cold streamì´ë¼ë©´ / StateFlowëŠ” hot stream
- UI ì‘ì—…ì„ ìœ„í•´ì„œëŠ” ë°ì´í„° í™€ë”ë¡œì¨ StateFlow ì‚¬ìš©ì´ ì¼ë°˜ì ì„
- LiveDataì™€ ê¸°ë³¸ì ìœ¼ë¡œ ì—­í• ì´ ë™ì¼ (LiveDataëŠ” ì•ˆë“œë¡œì´ë“œì— ì˜ì¡´ì ì´ë¼ Flow ì‚¬ìš©)

- StateFlowì˜ ì†Œë¹„:
    - (ë ˆê±°ì‹œ) Viewë‹¨ì—ì„œ ì†Œë¹„í•  ë•ŒëŠ” ì•ˆë“œë¡œì´ë“œì˜ ë¼ì´í”„ì‚¬ì´í´ì— ë§ëŠ” ì•ˆì „í•œ ì½”ë“œ ì‘ì„±

### ğŸ“Œ SharedFlow

```kotlin
private var _event = MutableSharedFlow(MainEvent())    // ì“°ê¸° ê°€ëŠ¥í•œ SharedFlow
val event: SharedFlow<MainEvent> = _event    // ì½ê¸° ì „ìš© SharedFlow
```

- ì´ê²ƒë„ hotì„
- ì´ˆê¸°ê°’ì„ ê°€ì§€ì§€ ì•ŠëŠ”ë‹¤
- ë°ì´í„°ë¥¼ ì½ì–´ ë“¤ì´ê¸° ì „ì—ëŠ” ì•„ë¬´ê°’ë„ ì—†ëŠ” ë°ì´í„°ì— ì í•©
- repeat
- **Flowë¥¼ shareInìœ¼ë¡œ SharedFlowë¡œ ë³€í™˜ ê°€ëŠ¥í•¨**
- ì›íƒ€ì„ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  ë•Œ ìœ ìš©í•¨

- `shareIn` : Flow(cold)ë¥¼ SharedFlow(hot)ë¡œ ë³€í™˜

```kotlin
public fun <T> Flow<T>.shareIn(
    scope: CoroutineScope,
    started: SharingStarted,
    replay: Int = 0
): SharedFlow<T>
```

- íŒŒë¼ë¯¸í„°
    - scope : the coroutine scope in which sharing is started.
    - started : the strategy that controls when sharing is started and stopped.
    - replay : the number of values replayed to new subscribers (cannot be negative, defaults to zero).